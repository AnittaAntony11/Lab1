<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dish Recipes</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
    }
  </style>
</head>
<body>
  <h1>Dish Recipes</h1>
  
  <!-- Form for adding a new dish -->
  <form id="addDishForm">
    <h2>Add New Dish</h2>
    <input type="text" name="name" placeholder="Name" required>
    <input type="text" name="ingredients" placeholder="Ingredients (comma separated)" required>
    <input type="text" name="preparationSteps" placeholder="Preparation Steps" required>
    <input type="number" name="cookingTime" placeholder="Cooking Time (min)" required>
    <input type="text" name="origin" placeholder="Origin" required>
    <input type="text" name="spiceLevel" placeholder="Spice Level">
    <button type="submit">Add Dish</button>
  </form>
  
  <!-- Table for displaying the dishes -->
  <table id="dishesTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Ingredients</th>
        <th>Preparation Steps</th>
        <th>Cooking Time</th>
        <th>Origin</th>
        <th>Spice Level</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows will be dynamically generated -->
    </tbody>
  </table>
  
  <script>
    // Function to fetch and display all dishes
    async function fetchDishes() {
      const response = await fetch('/api/dishes');
      const dishes = await response.json();
      const tbody = document.getElementById('dishesTable').querySelector('tbody');
      tbody.innerHTML = ''; // Clear existing rows
      
      dishes.forEach(dish => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${dish.name}</td>
          <td>${dish.ingredients.join(', ')}</td>
          <td>${dish.preparationSteps}</td>
          <td>${dish.cookingTime}</td>
          <td>${dish.origin}</td>
          <td>${dish.spiceLevel || ''}</td>
          <td>
            <button onclick="editDish('${dish._id}')">Update</button>
            <button onclick="deleteDish('${dish._id}')">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }
    
    // Handle form submission for adding a new dish
    document.getElementById('addDishForm').addEventListener('submit', async function(e) {
      e.preventDefault(); // Prevent page reload
      const formData = new FormData(this);
      const data = {
        name: formData.get('name'),
        ingredients: formData.get('ingredients').split(',').map(item => item.trim()),
        preparationSteps: formData.get('preparationSteps'),
        cookingTime: Number(formData.get('cookingTime')),
        origin: formData.get('origin'),
        spiceLevel: formData.get('spiceLevel')
      };
      
      const res = await fetch('/api/dishes', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      
      if (res.status === 201) {
        alert('Dish added successfully!');
      } else if (res.status === 409) {
        alert('Dish already exists!');
      }
      
      fetchDishes(); // Refresh the dish list
      this.reset(); // Clear the form
    });
    
    // Function to delete a dish
    async function deleteDish(dishId) {
      if (confirm('Are you sure you want to delete this dish?')) {
        const res = await fetch(`/api/dishes/${dishId}`, { method: 'DELETE' });
        if (res.ok) {
          alert('Dish deleted successfully!');
          fetchDishes();
        } else {
          alert('Error deleting dish.');
        }
      }
    }
    
    // Function to update a dish (simple example with a prompt)
    async function editDish(dishId) {
      const newName = prompt('Enter new dish name:');
      if (!newName) return;
      
      const updatedData = { name: newName };
      const res = await fetch(`/api/dishes/${dishId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updatedData)
      });
      
      if (res.ok) {
        alert('Dish updated successfully!');
        fetchDishes();
      } else {
        alert('Error updating dish.');
      }
    }
    
    // Fetch the list of dishes when the page loads
    fetchDishes();
  </script>
</body>
</html>
